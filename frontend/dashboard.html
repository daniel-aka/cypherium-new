<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cypherium | Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link href="css/styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0A2463;
            --secondary-color: #247BA0;
            --accent-color: #00FF9D;
            --dark-color: #1A1A1A;
            --light-color: #F5F5F5;
            --success-color: #00C853;
            --warning-color: #FFD600;
            --danger-color: #FF1744;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .navbar {
            background-color: var(--primary-color) !important;
            padding: 1rem 0;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--accent-color) !important;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--accent-color) !important;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .stat-card {
            padding: 1.5rem;
        }

        .stat-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .welcome-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .welcome-text {
            opacity: 0.9;
        }

        .balance-info {
            text-align: right;
        }

        .balance-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .balance-amount {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0;
            color: var(--accent-color);
        }

        .table {
            margin-bottom: 0;
        }

        .table th {
            font-weight: 600;
            color: var(--primary-color);
            border-top: none;
        }

        .table td {
            vertical-align: middle;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            font-weight: 500;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-outline-light {
            border-radius: 25px;
            padding: 0.5rem 1.5rem;
            font-weight: 500;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 2rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .action-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .action-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .action-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .action-description {
            color: #666;
            font-size: 0.9rem;
        }

        .plan-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            height: 100%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            color: #333;
        }

        .plan-card:hover {
            transform: translateY(-5px);
        }

        .gold-plan {
            border: 2px solid #FFD700;
            background: linear-gradient(to bottom, #fff, #fff9e6);
        }

        .silver-plan {
            border: 2px solid #C0C0C0;
            background: linear-gradient(to bottom, #fff, #f8f8f8);
        }

        .bronze-plan {
            border: 2px solid #CD7F32;
            background: linear-gradient(to bottom, #fff, #fff5e6);
        }

        .plan-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .plan-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .plan-roi {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--success-color);
        }

        .plan-details {
            color: #666;
        }

        .plan-details p {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .form-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .form-title {
            color: #333;
            font-weight: 600;
        }

        .form-label {
            color: #333;
            font-weight: 500;
        }

        .btn-invest {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            font-weight: 500;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-invest:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .profit-display {
            background: var(--light-color);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .profit-label {
            color: #666;
            margin-bottom: 0.5rem;
        }

        .profit-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success-color);
            margin-bottom: 0;
        }

        .payment-icon {
            background: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .payment-icon i {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .welcome-section {
                padding: 1.5rem;
                text-align: center;
            }

            .balance-info {
                text-align: center;
                margin-top: 1rem;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .action-card {
                padding: 1rem;
            }

            .stat-card {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .table-responsive {
                margin-bottom: 1rem;
            }

            .navbar-brand {
                font-size: 1.2rem;
            }

            .nav-link {
                padding: 0.5rem 1rem;
            }

            .user-dropdown {
                margin-top: 1rem;
            }
        }

        /* Modal Styles */
        .modal-content {
            border-radius: 15px;
            border: none;
        }

        .modal-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .modal-title {
            font-weight: 600;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            border-top: none;
            padding: 1rem 1.5rem;
        }

        .form-label {
            font-weight: 500;
            color: var(--primary-color);
        }

        .form-control {
            border-radius: 8px;
            padding: 0.75rem;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(10, 36, 99, 0.25);
        }

        .navbar-toggler {
            border-color: white;
        }

        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 1%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }
    </style>
</head>
<body>
    <!--Start of Tawk.to Script-->
    <script type="text/javascript">
        var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
        (function(){
            var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
            s1.async=true;
            s1.src='https://embed.tawk.to/67e1e2e6f421cd1907c279af/1in55sl5c';
            s1.charset='UTF-8';
            s1.setAttribute('crossorigin','*');
            s0.parentNode.insertBefore(s1,s0);
        })();
    </script>
    <!--End of Tawk.to Script-->

    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">Cypherium</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="investment.html">Investment</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Transactions</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Wallet</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <div class="dropdown me-3">
                        <button class="btn btn-outline-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-2"></i>
                            <span id="userName">User</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-shield-lock me-2"></i>Security</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <main class="container py-4">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 class="welcome-title">Welcome, <span id="userFullName">User</span>!</h1>
                    <p class="welcome-text">Manage your investments and track your earnings</p>
                </div>
                <div class="col-md-6 balance-info">
                    <p class="balance-title">Available Balance</p>
                    <h2 class="balance-amount">$<span id="walletBalance">0.00</span></h2>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="action-card" data-bs-toggle="modal" data-bs-target="#newInvestmentModal">
                <i class="bi bi-graph-up action-icon"></i>
                <h3 class="action-title">New Investment</h3>
                <p class="action-description">Start a new investment plan</p>
            </div>
            <div class="action-card" data-bs-toggle="modal" data-bs-target="#depositModal">
                <i class="bi bi-wallet2 action-icon"></i>
                <h3 class="action-title">Deposit</h3>
                <p class="action-description">Add funds to your account</p>
            </div>
            <div class="action-card" data-bs-toggle="modal" data-bs-target="#withdrawModal">
                <i class="bi bi-cash-stack action-icon"></i>
                <h3 class="action-title">Withdraw</h3>
                <p class="action-description">Withdraw your earnings</p>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-4">
                <div class="dashboard-card stat-card">
                    <i class="bi bi-wallet2 stat-icon"></i>
                    <h3 class="stat-value" id="walletBalance">$0.00</h3>
                    <p class="stat-label">Wallet Balance</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="dashboard-card stat-card">
                    <i class="bi bi-graph-up stat-icon"></i>
                    <h3 class="stat-value" id="totalInvestments">$0.00</h3>
                    <p class="stat-label">Total Investments</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="dashboard-card stat-card">
                    <i class="bi bi-currency-dollar stat-icon"></i>
                    <h3 class="stat-value" id="totalEarnings">$0.00</h3>
                    <p class="stat-label">Total Earnings</p>
                </div>
            </div>
        </div>

        <!-- Investment History -->
        <div class="dashboard-card">
            <div class="card-body">
                <div class="text-center mb-4">
                    <h5 class="card-title mb-0">Investment History</h5>
                </div>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Plan</th>
                                <th>Amount</th>
                                <th>Daily Return</th>
                                <th>Total Return</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="investmentHistory">
                            <tr>
                                <td colspan="6" class="text-center">Loading investments...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Live Chat Modal -->
    <div class="modal fade" id="liveChatModal" tabindex="-1" aria-labelledby="liveChatModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="liveChatModalLabel">Investment Plans</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Investment Plans Section -->
                    <div id="investmentPlansSection">
                        <div class="section-header text-center mb-4">
                            <h2 class="section-subtitle">Choose Your Plan</h2>
                        </div>

                        <div class="row">
                            <!-- Gold Plan -->
                            <div class="col-lg-4 mb-4">
                                <div class="plan-card gold-plan">
                                    <div class="plan-header">
                                        <h3 class="plan-name">GOLD PLAN</h3>
                                        <div class="plan-roi">120% ROI</div>
                                    </div>
                                    <div class="plan-details">
                                        <p class="plan-duration"><i class="bi bi-calendar me-2"></i> Daily for 30 Days</p>
                                        <p class="plan-min"><i class="bi bi-arrow-up me-2"></i> Min. Invest $25,000</p>
                                        <p class="plan-max"><i class="bi bi-arrow-down me-2"></i> Max. Invest $500,000</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Silver Plan -->
                            <div class="col-lg-4 mb-4">
                                <div class="plan-card silver-plan">
                                    <div class="plan-header">
                                        <h3 class="plan-name">SILVER PLAN</h3>
                                        <div class="plan-roi">80% ROI</div>
                                    </div>
                                    <div class="plan-details">
                                        <p class="plan-duration"><i class="bi bi-calendar me-2"></i> Daily for 30 Days</p>
                                        <p class="plan-min"><i class="bi bi-arrow-up me-2"></i> Min. Invest $500</p>
                                        <p class="plan-max"><i class="bi bi-arrow-down me-2"></i> Max. Invest $24,000</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Bronze Plan -->
                            <div class="col-lg-4 mb-4">
                                <div class="plan-card bronze-plan">
                                    <div class="plan-header">
                                        <h3 class="plan-name">BRONZE PLAN</h3>
                                        <div class="plan-roi">50% ROI</div>
                                    </div>
                                    <div class="plan-details">
                                        <p class="plan-duration"><i class="bi bi-calendar me-2"></i> Daily for 30 Days</p>
                                        <p class="plan-min"><i class="bi bi-arrow-up me-2"></i> Min. Invest $200</p>
                                        <p class="plan-max"><i class="bi bi-arrow-down me-2"></i> Max. Invest $12,500</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Investment Form -->
                        <div class="investment-form mt-4">
                            <div class="row justify-content-center">
                                <div class="col-lg-8">
                                    <div class="form-card">
                                        <h3 class="form-title text-center mb-4">Start Investing</h3>
                                        
                                        <div class="row">
                                            <div class="col-md-6 mb-4">
                                                <label class="form-label">Choose Plan:</label>
                                                <select class="form-select plan-select" id="planSelect" onchange="updateAmountLimits()">
                                                    <option value="">Select a plan</option>
                                                    <option value="Gold Plan">Gold Plan ($25,000 - $500,000)</option>
                                                    <option value="Silver Plan">Silver Plan ($500 - $24,000)</option>
                                                    <option value="Bronze Plan">Bronze Plan ($200 - $12,500)</option>
                                                </select>
                                            </div>
                                            
                                            <div class="col-md-6 mb-4">
                                                <label class="form-label">Enter Amount ($):</label>
                                                <input type="number" class="form-control amount-input" id="investmentAmount" min="200" step="1" oninput="validateAmount()">
                                                <div class="form-text" id="amountHelp"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="profit-display">
                                                    <p class="profit-label">Daily Profit</p>
                                                    <p class="profit-value daily-profit" id="dailyProfit">$0.00</p>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-6 mb-3">
                                                <div class="profit-display">
                                                    <p class="profit-label">Total Profit</p>
                                                    <p class="profit-value total-profit" id="totalProfit">$0.00</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="text-center mt-4">
                                            <button class="btn btn-invest" id="investButton" onclick="submitInvestment()">Invest Now <i class="bi bi-arrow-right ms-2"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Methods -->
                        <div class="payment-methods mt-4">
                            <h3 class="text-center mb-4">We Accept Payment Methods</h3>
                            <div class="d-flex flex-wrap justify-content-center gap-3">
                                <div class="payment-icon"><i class="bi bi-currency-btc"></i> Bitcoin</div>
                                <div class="payment-icon"><i class="bi bi-currency-eth"></i> Ethereum</div>
                                <div class="payment-icon"><i class="bi bi-paypal"></i> Paypal</div>
                                <div class="payment-icon"><i class="bi bi-cash"></i> Cash App</div>
                                <div class="payment-icon"><i class="bi bi-wallet2"></i> Venmo</div>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Section (Initially Hidden) -->
                    <div id="chatSection" style="display: none;">
                        <div class="chat-container" style="height: 500px;">
                            <div id="tawkto-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Investment Instructions Modal -->
    <div class="modal fade" id="investmentInstructionsModal" tabindex="-1" aria-labelledby="investmentInstructionsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="investmentInstructionsModalLabel">Investment Instructions</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        Please copy the investment details below and paste them into the live chat.
                    </div>
                    <div class="form-group">
                        <label class="form-label">Investment Details:</label>
                        <textarea class="form-control" id="investmentDetails" rows="8" readonly></textarea>
                    </div>
                    <div class="text-center mt-3">
                        <button class="btn btn-primary" onclick="copyToClipboard()">
                            <i class="bi bi-clipboard me-2"></i>Copy to Clipboard
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdrawal Modal -->
    <div class="modal fade" id="withdrawalModal" tabindex="-1" aria-labelledby="withdrawalModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="withdrawalModalLabel">Withdraw Funds</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="form-card">
                                <h3 class="form-title text-center mb-4">Withdraw Your Earnings</h3>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <label class="form-label">Available Balance:</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="text" class="form-control" id="availableBalance" readonly>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6 mb-4">
                                        <label class="form-label">Withdrawal Amount ($):</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control" id="withdrawalAmount" min="100" step="1" oninput="validateWithdrawalAmount()">
                                        </div>
                                        <div class="form-text" id="withdrawalHelp"></div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <label class="form-label">Payment Method:</label>
                                        <select class="form-select" id="paymentMethod" onchange="updatePaymentDetails()">
                                            <option value="">Select payment method</option>
                                            <option value="Bitcoin">Bitcoin</option>
                                            <option value="Ethereum">Ethereum</option>
                                            <option value="PayPal">PayPal</option>
                                            <option value="CashApp">Cash App</option>
                                            <option value="Venmo">Venmo</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-6 mb-4">
                                        <label class="form-label">Payment Details:</label>
                                        <input type="text" class="form-control" id="paymentDetails" placeholder="Enter your payment details">
                                        <div class="form-text" id="paymentHelp"></div>
                                    </div>
                                </div>
                                
                                <div class="text-center mt-4">
                                    <button class="btn btn-invest" id="withdrawButton" onclick="submitWithdrawal()">Withdraw Now <i class="bi bi-arrow-right ms-2"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdrawal Instructions Modal -->
    <div class="modal fade" id="withdrawalInstructionsModal" tabindex="-1" aria-labelledby="withdrawalInstructionsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="withdrawalInstructionsModalLabel">Withdrawal Instructions</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        Please copy the withdrawal details below and paste them into the live chat.
                    </div>
                    <div class="form-group">
                        <label class="form-label">Withdrawal Details:</label>
                        <textarea class="form-control" id="withdrawalDetails" rows="8" readonly></textarea>
                    </div>
                    <div class="text-center mt-3">
                        <button class="btn btn-primary" onclick="copyWithdrawalToClipboard()">
                            <i class="bi bi-clipboard me-2"></i>Copy to Clipboard
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Balance Management Modal -->
    <div class="modal fade" id="balanceModal" tabindex="-1" aria-labelledby="balanceModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="balanceModalLabel">Manage Balance</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-card">
                        <h3 class="form-title text-center mb-4">Update Balance</h3>
                        
                        <div class="mb-4">
                            <label class="form-label">Current Balance:</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="text" class="form-control" id="currentBalance" readonly>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">Operation:</label>
                            <select class="form-select" id="balanceOperation" onchange="updateAmountLabel()">
                                <option value="add">Add Funds</option>
                                <option value="subtract">Subtract Funds</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label" id="amountLabel">Amount to Add ($):</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" class="form-control" id="balanceAmount" min="0" step="0.01" oninput="validateBalanceAmount()">
                            </div>
                            <div class="form-text" id="balanceHelp"></div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-invest" id="updateBalanceButton" onclick="updateBalance()">Update Balance <i class="bi bi-arrow-right ms-2"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Investment Modal -->
    <div class="modal fade" id="newInvestmentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Investment</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="investmentForm">
                        <div class="mb-3">
                            <label for="investmentAmount" class="form-label">Investment Amount ($)</label>
                            <input type="number" class="form-control" id="investmentAmount" required>
                        </div>
                        <div class="mb-3">
                            <label for="investmentPlan" class="form-label">Investment Plan</label>
                            <select class="form-select" id="investmentPlan" required>
                                <option value="">Select a plan</option>
                                <option value="basic">Basic Plan (5% daily)</option>
                                <option value="premium">Premium Plan (10% daily)</option>
                                <option value="vip">VIP Plan (15% daily)</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitInvestment()">Invest</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit Modal -->
    <div class="modal fade" id="depositModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Deposit Funds</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="depositForm">
                        <div class="mb-3">
                            <label for="depositAmount" class="form-label">Amount ($)</label>
                            <input type="number" class="form-control" id="depositAmount" required>
                        </div>
                        <div class="mb-3">
                            <label for="paymentMethod" class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethod" required>
                                <option value="">Select payment method</option>
                                <option value="credit">Credit Card</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="crypto">Cryptocurrency</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitDeposit()">Deposit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal fade" id="withdrawModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Withdraw Funds</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="withdrawForm">
                        <div class="mb-3">
                            <label for="withdrawAmount" class="form-label">Amount ($)</label>
                            <input type="number" class="form-control" id="withdrawAmount" required>
                        </div>
                        <div class="mb-3">
                            <label for="withdrawMethod" class="form-label">Withdrawal Method</label>
                            <select class="form-select" id="withdrawMethod" required>
                                <option value="">Select withdrawal method</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="crypto">Cryptocurrency</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitWithdraw()">Withdraw</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS + Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Tawk.to Script -->
    <script type="text/javascript">
        var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
        (function(){
            var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
            s1.async=true;
            s1.src='https://embed.tawk.to/67e1e2e6f421cd1907c279af/1in55sl5c';
            s1.charset='UTF-8';
            s1.setAttribute('crossorigin','*');
            s0.parentNode.insertBefore(s1,s0);
        })();
    </script>
    <script>
        // Check authentication on page load
        if (!auth.checkAuth()) {
            console.log('Not authenticated, redirecting to login...');
        } else {
            // Load user info
            const user = JSON.parse(localStorage.getItem('user'));
            const username = user.username || user.email || 'User';
            document.getElementById('userName').textContent = username;
            document.getElementById('userFullName').textContent = username;
            document.getElementById('walletBalance').textContent = `$${user.balance.toFixed(2)}`;
            document.getElementById('totalInvestments').textContent = `$${user.totalInvested.toFixed(2)}`;
            document.getElementById('totalEarnings').textContent = `$${user.totalEarnings.toFixed(2)}`;
            loadUserData();
        }

        // Load user data
        async function loadUserData() {
            try {
                const response = await fetch(`${api.baseUrl}/api/users/profile`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load user data');
                }

                const data = await response.json();
                const username = data.username || data.email || 'User';
                
                // Update username in dropdown
                document.getElementById('userName').textContent = username;
                document.getElementById('userFullName').textContent = username;

                // Update wallet balance
                const walletBalanceElement = document.getElementById('walletBalance');
                if (walletBalanceElement && data.balance !== undefined) {
                    walletBalanceElement.textContent = `$${data.balance.toFixed(2)}`;
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Check if user is authenticated
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            // Fetch user data and investments
            try {
                const [userResponse, investmentsResponse] = await Promise.all([
                    fetch('/api/user', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    }),
                    fetch('/api/investments/my-investments', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    })
                ]);

                if (!userResponse.ok || !investmentsResponse.ok) {
                    throw new Error('Failed to fetch data');
                }

                const userData = await userResponse.json();
                const investments = await investmentsResponse.json();

                // Update dashboard with user data
                document.getElementById('userName').textContent = userData.username;
                document.getElementById('userFullName').textContent = userData.fullName || userData.username;
                document.getElementById('walletBalance').textContent = `$${userData.balance.toFixed(2)}`;
                document.getElementById('totalInvestments').textContent = `$${userData.totalInvested.toFixed(2)}`;
                document.getElementById('totalEarnings').textContent = `$${userData.totalEarnings.toFixed(2)}`;

                // Update investment history
                updateInvestmentHistory(investments);
            } catch (error) {
                console.error('Error fetching data:', error);
                showAlert('Error loading dashboard data', 'danger');
            }

            // Add logout functionality
            document.getElementById('logoutBtn').addEventListener('click', () => {
                localStorage.removeItem('token');
                window.location.href = 'login.html';
            });
        });

        function updateInvestmentHistory(investments) {
            const tbody = document.getElementById('investmentHistory');
            if (!investments || investments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">No investments yet</td></tr>';
                return;
            }

            tbody.innerHTML = investments.map(inv => `
                <tr>
                    <td>${new Date(inv.createdAt).toLocaleDateString()}</td>
                    <td>${inv.planType.charAt(0).toUpperCase() + inv.planType.slice(1)}</td>
                    <td>$${inv.amount.toFixed(2)}</td>
                    <td>$${inv.dailyReturn.toFixed(2)}</td>
                    <td>$${inv.totalReturn.toFixed(2)}</td>
                    <td><span class="status-badge bg-${getStatusColor(inv.status)}">${inv.status}</span></td>
                </tr>
            `).join('');
        }

        function getStatusColor(status) {
            switch (status) {
                case 'active': return 'success';
                case 'pending': return 'warning';
                case 'completed': return 'info';
                case 'cancelled': return 'danger';
                default: return 'secondary';
            }
        }

        function showAlert(message, type) {
            const alertContainer = document.createElement('div');
            alertContainer.className = `alert alert-${type} alert-dismissible fade show mt-3`;
            alertContainer.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.container').insertBefore(alertContainer, document.querySelector('.row'));
        }

        // Initialize modals
        const liveChatModal = new bootstrap.Modal(document.getElementById('liveChatModal'));
        const investmentInstructionsModal = new bootstrap.Modal(document.getElementById('investmentInstructionsModal'));
        const withdrawalModal = new bootstrap.Modal(document.getElementById('withdrawalModal'));
        const withdrawalInstructionsModal = new bootstrap.Modal(document.getElementById('withdrawalInstructionsModal'));
        const balanceModal = new bootstrap.Modal(document.getElementById('balanceModal'));

        // Add click handlers to the action cards
        document.querySelector('.action-card:nth-child(1)').addEventListener('click', () => {
            openLiveChat('investment');
        });

        document.querySelector('.action-card:nth-child(2)').addEventListener('click', () => {
            openBalanceModal();
        });

        document.querySelector('.action-card:nth-child(3)').addEventListener('click', () => {
            openWithdrawalModal();
        });

        // Function to calculate profits
        function calculateProfits() {
            const planSelect = document.getElementById('planSelect');
            const amountInput = document.getElementById('investmentAmount');
            const amount = parseFloat(amountInput.value) || 0;
            
            let dailyRate, totalRate;
            switch(planSelect.value) {
                case 'Gold Plan':
                    dailyRate = 0.04; // 4% daily
                    totalRate = 1.2; // 120% total
                    break;
                case 'Silver Plan':
                    dailyRate = 0.0267; // 2.67% daily
                    totalRate = 0.8; // 80% total
                    break;
                case 'Bronze Plan':
                    dailyRate = 0.0167; // 1.67% daily
                    totalRate = 0.5; // 50% total
                    break;
            }

            const dailyProfit = amount * dailyRate;
            const totalProfit = amount * totalRate;

            document.getElementById('dailyProfit').textContent = `$${dailyProfit.toFixed(2)}`;
            document.getElementById('totalProfit').textContent = `$${totalProfit.toFixed(2)}`;
        }

        // Add event listeners for real-time calculation
        document.getElementById('planSelect').addEventListener('change', calculateProfits);
        document.getElementById('investmentAmount').addEventListener('input', calculateProfits);

        // Function to update amount limits based on selected plan
        function updateAmountLimits() {
            const planSelect = document.getElementById('planSelect');
            const amountInput = document.getElementById('investmentAmount');
            const amountHelp = document.getElementById('amountHelp');
            const investButton = document.getElementById('investButton');

            if (!planSelect.value) {
                amountInput.disabled = true;
                amountInput.value = '';
                amountHelp.textContent = 'Please select a plan first';
                investButton.disabled = true;
                return;
            }

            amountInput.disabled = false;
            investButton.disabled = false;

            switch(planSelect.value) {
                case 'Gold Plan':
                    amountInput.min = 25000;
                    amountInput.max = 500000;
                    amountHelp.textContent = `Enter amount between $25,000 and $500,000`;
                    break;
                case 'Silver Plan':
                    amountInput.min = 500;
                    amountInput.max = 24000;
                    amountHelp.textContent = `Enter amount between $500 and $24,000`;
                    break;
                case 'Bronze Plan':
                    amountInput.min = 200;
                    amountInput.max = 12500;
                    amountHelp.textContent = `Enter amount between $200 and $12,500`;
                    break;
            }

            validateAmount();
        }

        // Function to validate amount
        function validateAmount() {
            const planSelect = document.getElementById('planSelect');
            const amountInput = document.getElementById('investmentAmount');
            const amountHelp = document.getElementById('amountHelp');
            const investButton = document.getElementById('investButton');

            if (!planSelect.value) {
                amountHelp.textContent = 'Please select a plan first';
                investButton.disabled = true;
                return;
            }

            const amount = parseFloat(amountInput.value) || 0;
            let minAmount, maxAmount;

            switch(planSelect.value) {
                case 'Gold Plan':
                    minAmount = 25000;
                    maxAmount = 500000;
                    break;
                case 'Silver Plan':
                    minAmount = 500;
                    maxAmount = 24000;
                    break;
                case 'Bronze Plan':
                    minAmount = 200;
                    maxAmount = 12500;
                    break;
            }

            if (amount < minAmount) {
                amountHelp.textContent = `Minimum amount is $${minAmount}`;
                investButton.disabled = true;
            } else if (amount > maxAmount) {
                amountHelp.textContent = `Maximum amount is $${maxAmount}`;
                investButton.disabled = true;
            } else {
                amountHelp.textContent = '';
                investButton.disabled = false;
            }

            calculateProfits();
        }

        // Function to submit investment
        function submitInvestment() {
            const planSelect = document.getElementById('planSelect');
            const amountInput = document.getElementById('investmentAmount');
            const amount = parseFloat(amountInput.value) || 0;

            if (!planSelect.value) {
                showAlert('Please select a plan', 'danger');
                return;
            }

            // Validate amount based on plan
            let minAmount, maxAmount;
            switch(planSelect.value) {
                case 'Gold Plan':
                    minAmount = 25000;
                    maxAmount = 500000;
                    break;
                case 'Silver Plan':
                    minAmount = 500;
                    maxAmount = 24000;
                    break;
                case 'Bronze Plan':
                    minAmount = 200;
                    maxAmount = 12500;
                    break;
            }

            if (!amount || amount < minAmount || amount > maxAmount) {
                showAlert(`Please enter an amount between $${minAmount} and $${maxAmount} for the ${planSelect.value}`, 'danger');
                return;
            }

            // Calculate profits
            let dailyRate, totalRate;
            switch(planSelect.value) {
                case 'Gold Plan':
                    dailyRate = 0.04;
                    totalRate = 1.2;
                    break;
                case 'Silver Plan':
                    dailyRate = 0.0267;
                    totalRate = 0.8;
                    break;
                case 'Bronze Plan':
                    dailyRate = 0.0167;
                    totalRate = 0.5;
                    break;
            }

            const dailyProfit = amount * dailyRate;
            const totalProfit = amount * totalRate;

            // Generate investment details message
            const investmentDetails = `I would like to invest $${amount.toFixed(2)} in the ${planSelect.value}.\n\nInvestment Details:\n- Amount: $${amount.toFixed(2)}\n- Daily Profit: $${dailyProfit.toFixed(2)}\n- Total Profit: $${totalProfit.toFixed(2)}\n- Duration: 30 Days\n\nPlease provide payment instructions.`;

            // Set the investment details in the textarea
            document.getElementById('investmentDetails').value = investmentDetails;

            // Close the investment modal and show the instructions modal
            liveChatModal.hide();
            investmentInstructionsModal.show();
        }

        // Function to copy text to clipboard
        function copyToClipboard() {
            const textarea = document.getElementById('investmentDetails');
            textarea.select();
            document.execCommand('copy');
            
            // Show success message
            const button = document.querySelector('#investmentInstructionsModal .btn-primary');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="bi bi-check-circle me-2"></i>Copied!';
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 2000);

            // Open Tawk.to chat
            Tawk_API.maximize();
        }

        // Function to update the openLiveChat function
        function openLiveChat(action) {
            // Reset modal state
            document.getElementById('investmentPlansSection').style.display = 'block';
            document.getElementById('chatSection').style.display = 'none';
            document.getElementById('liveChatModalLabel').textContent = 'Investment Plans';

            // Show the modal
            liveChatModal.show();
        }

        // Handle modal close
        document.getElementById('liveChatModal').addEventListener('hidden.bs.modal', function () {
            // Reset modal state
            document.getElementById('investmentPlansSection').style.display = 'block';
            document.getElementById('chatSection').style.display = 'none';
            document.getElementById('liveChatModalLabel').textContent = 'Investment Plans';
        });

        // Initialize form state
        document.addEventListener('DOMContentLoaded', () => {
            updateAmountLimits();
        });

        // Function to open withdrawal modal
        function openWithdrawalModal() {
            // Set available balance
            const availableBalance = document.getElementById('walletBalance').textContent.replace('$', '');
            document.getElementById('availableBalance').value = availableBalance;
            
            // Reset form
            document.getElementById('withdrawalAmount').value = '';
            document.getElementById('paymentMethod').value = '';
            document.getElementById('paymentDetails').value = '';
            document.getElementById('withdrawalHelp').textContent = '';
            document.getElementById('paymentHelp').textContent = '';
            document.getElementById('withdrawButton').disabled = true;
            
            // Show modal
            withdrawalModal.show();
        }

        // Function to validate withdrawal amount
        function validateWithdrawalAmount() {
            const availableBalance = parseFloat(document.getElementById('availableBalance').value) || 0;
            const withdrawalAmount = parseFloat(document.getElementById('withdrawalAmount').value) || 0;
            const withdrawalHelp = document.getElementById('withdrawalHelp');
            const withdrawButton = document.getElementById('withdrawButton');

            if (withdrawalAmount < 100) {
                withdrawalHelp.textContent = 'Minimum withdrawal amount is $100';
                withdrawButton.disabled = true;
            } else if (withdrawalAmount > availableBalance) {
                withdrawalHelp.textContent = 'Insufficient balance';
                withdrawButton.disabled = true;
            } else {
                withdrawalHelp.textContent = '';
                if (document.getElementById('paymentMethod').value && document.getElementById('paymentDetails').value) {
                    withdrawButton.disabled = false;
                }
            }
        }

        // Function to update payment details
        function updatePaymentDetails() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            const paymentDetails = document.getElementById('paymentDetails');
            const paymentHelp = document.getElementById('paymentHelp');
            const withdrawButton = document.getElementById('withdrawButton');

            paymentDetails.value = '';
            paymentHelp.textContent = '';

            switch(paymentMethod) {
                case 'Bitcoin':
                    paymentHelp.textContent = 'Enter your Bitcoin wallet address';
                    break;
                case 'Ethereum':
                    paymentHelp.textContent = 'Enter your Ethereum wallet address';
                    break;
                case 'PayPal':
                    paymentHelp.textContent = 'Enter your PayPal email address';
                    break;
                case 'CashApp':
                    paymentHelp.textContent = 'Enter your Cash App username';
                    break;
                case 'Venmo':
                    paymentHelp.textContent = 'Enter your Venmo username';
                    break;
            }

            if (paymentMethod && paymentDetails.value && !document.getElementById('withdrawalHelp').textContent) {
                withdrawButton.disabled = false;
            }
        }

        // Function to submit withdrawal
        function submitWithdrawal() {
            const amount = parseFloat(document.getElementById('withdrawalAmount').value) || 0;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const paymentDetails = document.getElementById('paymentDetails').value;

            if (!amount || amount < 100) {
                showAlert('Please enter a valid withdrawal amount (minimum $100)', 'danger');
                return;
            }

            if (!paymentMethod || !paymentDetails) {
                showAlert('Please provide payment method and details', 'danger');
                return;
            }

            // Generate withdrawal details message
            const withdrawalDetails = `I would like to withdraw $${amount.toFixed(2)}.\n\nWithdrawal Details:\n- Amount: $${amount.toFixed(2)}\n- Payment Method: ${paymentMethod}\n- Payment Details: ${paymentDetails}\n\nPlease process my withdrawal request.`;

            // Set the withdrawal details in the textarea
            document.getElementById('withdrawalDetails').value = withdrawalDetails;

            // Close the withdrawal modal and show the instructions modal
            withdrawalModal.hide();
            withdrawalInstructionsModal.show();
        }

        // Function to copy withdrawal details to clipboard
        function copyWithdrawalToClipboard() {
            const textarea = document.getElementById('withdrawalDetails');
            textarea.select();
            document.execCommand('copy');
            
            // Show success message
            const button = document.querySelector('#withdrawalInstructionsModal .btn-primary');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="bi bi-check-circle me-2"></i>Copied!';
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 2000);
        }

        // Add click handler for balance management
        document.querySelector('.action-card:nth-child(2)').addEventListener('click', () => {
            openBalanceModal();
        });

        // Function to open balance modal
        function openBalanceModal() {
            const currentBalance = document.getElementById('walletBalance').textContent.replace('$', '');
            document.getElementById('currentBalance').value = currentBalance;
            document.getElementById('balanceAmount').value = '';
            document.getElementById('balanceHelp').textContent = '';
            document.getElementById('updateBalanceButton').disabled = true;
            balanceModal.show();
        }

        // Function to update amount label based on operation
        function updateAmountLabel() {
            const operation = document.getElementById('balanceOperation').value;
            const label = document.getElementById('amountLabel');
            label.textContent = operation === 'add' ? 'Amount to Add ($):' : 'Amount to Subtract ($):';
            validateBalanceAmount();
        }

        // Function to validate balance amount
        function validateBalanceAmount() {
            const operation = document.getElementById('balanceOperation').value;
            const currentBalance = parseFloat(document.getElementById('currentBalance').value) || 0;
            const amount = parseFloat(document.getElementById('balanceAmount').value) || 0;
            const balanceHelp = document.getElementById('balanceHelp');
            const updateButton = document.getElementById('updateBalanceButton');

            if (amount <= 0) {
                balanceHelp.textContent = 'Please enter a valid amount';
                updateButton.disabled = true;
                return;
            }

            if (operation === 'subtract' && amount > currentBalance) {
                balanceHelp.textContent = 'Insufficient balance';
                updateButton.disabled = true;
                return;
            }

            balanceHelp.textContent = '';
            updateButton.disabled = false;
        }

        // Function to update balance
        async function updateBalance() {
            const operation = document.getElementById('balanceOperation').value;
            const amount = parseFloat(document.getElementById('balanceAmount').value) || 0;

            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/user/update-balance', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ amount, type: operation })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to update balance');
                }

                const data = await response.json();
                
                // Update the displayed balance
                document.getElementById('walletBalance').textContent = `$${data.newBalance.toFixed(2)}`;
                
                // Close the modal
                balanceModal.hide();
                
                // Show success message
                showAlert(`Balance ${operation === 'add' ? 'added' : 'subtracted'} successfully`, 'success');
            } catch (error) {
                showAlert(error.message, 'danger');
            }
        }
    </script>
</body>
</html>